<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Admin Dashboard - Sequential User IDs</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- === Custom CSS Styles === -->
    <style>
        :root {
            --sidebar-width: 240px;
        }

        body {
            display: flex;
            min-height: 100vh;
            background-color: #f8f9fa;
        }

        /* Sidebar Styling */
        aside {
            width: var(--sidebar-width);
            background-color: #212529; /* Darker sidebar */
            color: #dee2e6;
            padding: 1.5rem 1rem;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            position: fixed; /* Fixed sidebar */
            top: 0;
            bottom: 0;
            left: 0;
            z-index: 1030; /* Ensure it's above main content */
        }
        aside .dashboard-title {
            font-size: 1.5em;
            margin-bottom: 2rem;
            text-align: center;
            color: #fff;
            font-weight: 600;
        }
        aside .nav-link {
            padding: 0.75rem 1rem;
            color: #adb5bd;
            border-radius: 0.375rem; /* Bootstrap's default */
            margin-bottom: 0.25rem;
            transition: background-color 0.2s ease, color 0.2s ease;
            cursor: pointer; /* Indicate clickable */
        }
        aside .nav-link i {
            margin-right: 0.75rem;
            width: 1.2em; /* Icon spacing */
            text-align: center;
        }
        aside .nav-link:hover,
        aside .nav-link.active { /* Style for active link */
            background-color: #495057;
            color: #fff;
        }
        aside nav {
            flex-grow: 1;
        }

        /* Main Content Area Styling */
        main {
            flex-grow: 1;
            padding: 2rem;
            margin-left: var(--sidebar-width); /* Offset for the fixed sidebar */
            position: relative; /* Needed for absolute logout button if used */
        }
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #dee2e6;
        }
        .main-header h1 {
            margin-bottom: 0;
            color: #343a40;
            font-size: 1.8rem;
        }

        /* Panel Styling */
        .content-panel {
            display: none; /* Hide panels by default */
            animation: fadeIn 0.5s ease-in-out; /* Add a fade-in effect */
        }
        .content-panel.active {
            display: block; /* Show active panel */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); } /* Slight upward motion */
            to { opacity: 1; transform: translateY(0); }
        }

        /* Card headers in panels */
         .section-card .card-header {
             background-color: #f8f9fa; /* Lighter header */
             border-bottom: 1px solid #dee2e6;
             font-weight: 600;
             font-size: 1.1rem;
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 0.75rem 1.25rem;
         }
         .section-card .card-header i {
             margin-right: 0.5rem;
         }
         .section-card .card-header .btn {
             font-size: 0.85rem;
             padding: 0.3rem 0.7rem;
         }

        /* Stats Cards Styling */
        .stat-card .card-body { text-align: center; }
        .stat-card .card-title { font-size: 0.9rem; color: #6c757d; margin-bottom: 0.5rem; font-weight: 500; text-transform: uppercase; }
        .stat-card .stat-number { font-size: 2rem; font-weight: 700; color: #343a40; } /* Bolder number */

        /* Form Panel Styling */
        .form-panel .card-body { padding: 1.5rem; } /* Slightly less padding */
        .form-panel .card-header { font-size: 1.2rem; }
        .form-panel label { margin-bottom: 0.5rem; font-weight: 500; }
        .form-actions { margin-top: 1.5rem; display: flex; gap: 0.5rem; justify-content: flex-end; } /* Align buttons right */

        /* Table Styling */
        .table th { font-weight: 600; background-color: #e9ecef; } /* Header background */
        .table td, .table th { vertical-align: middle; }
        .action-buttons .btn { margin-right: 5px; padding: 0.25rem 0.5rem; font-size: 0.8rem; } /* Smaller action buttons */
        .action-buttons .btn:last-child { margin-right: 0; }
        .action-buttons .btn i { margin-right: 0; } /* No text space needed if icon only */

        /* Validation feedback */
        .form-control.is-invalid { border-color: #dc3545; }
        .invalid-feedback { display: none; width: 100%; margin-top: 0.25rem; font-size: .875em; color: #dc3545; }
        .form-control.is-invalid ~ .invalid-feedback { display: block; } /* Show feedback */

    </style>
    <!-- ================================ -->
</head>
<body>

    <!-- === Sidebar === -->
    <aside>
        <div class="dashboard-title"><i class="fas fa-shield-alt"></i> Admin Panel</div>
        <nav class="nav flex-column">
            <!-- Use data-target attribute to specify the panel ID -->
            <a class="nav-link active" data-target="dashboard-overview-panel"><i class="fas fa-tachometer-alt"></i> Overview</a>
            <a class="nav-link" data-target="stores-list-panel"><i class="fas fa-store"></i> Stores</a>
            <a class="nav-link" data-target="food-list-panel"><i class="fas fa-utensils"></i> Food Items</a>
            <a class="nav-link" data-target="orders-list-panel"><i class="fas fa-receipt"></i> Orders</a>
            <a class="nav-link" data-target="users-list-panel"><i class="fas fa-users"></i> Users</a>
        </nav>
    </aside>

    <!-- === Main Content === -->
    <main>
        <!-- Main Header with Title and Logout -->
        <div class="main-header">
             <h1 id="main-heading">Welcome Admin!</h1> <!-- Heading can be updated -->
             <a href="login.html" class="btn btn-outline-danger logout-button">
                 <i class="fas fa-sign-out-alt"></i> Logout
             </a>
        </div>

        <!-- == PANELS START == -->

        <!-- Dashboard Overview Panel -->
        <div id="dashboard-overview-panel" class="content-panel active">
            <h2>Dashboard Overview</h2>
             <div class="row mb-4 g-4">
                 <div class="col-md-6 col-xl-3">
                     <div class="card stat-card h-100 shadow-sm"> <div class="card-body"> <h5 class="card-title">Total Deliveries</h5> <p class="stat-number" id="total-deliveries">0</p> </div> </div>
                 </div>
                 <div class="col-md-6 col-xl-3">
                    <div class="card stat-card h-100 shadow-sm"> <div class="card-body"> <h5 class="card-title">Total Stores</h5> <p class="stat-number" id="total-stores">0</p> </div> </div>
                 </div>
                 <div class="col-md-6 col-xl-3">
                    <div class="card stat-card h-100 shadow-sm"> <div class="card-body"> <h5 class="card-title">Total Users</h5> <p class="stat-number" id="total-users">0</p> </div> </div>
                 </div>
                 <div class="col-md-6 col-xl-3">
                    <div class="card stat-card h-100 shadow-sm"> <div class="card-body"> <h5 class="card-title">Total Revenue</h5> <p class="stat-number" id="total-revenue">â‚±0.00</p> </div> </div>
                 </div>
             </div>
             <!-- Add more overview content if needed -->
             <div class="alert alert-info" role="alert">
               Welcome to the admin dashboard. Use the sidebar to navigate between sections.
             </div>
        </div>

        <!-- Stores List Panel -->
        <div id="stores-list-panel" class="content-panel">
            <div class="card section-card shadow-sm">
                <div class="card-header">
                    <span><i class="fas fa-store"></i> Manage Stores</span>
                    <button class="btn btn-primary btn-sm add-btn" data-form-target="store-form-panel" data-list-target="stores-list-panel">
                        <i class="fas fa-plus"></i> Add New Store
                    </button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                         <table class="table table-striped table-hover table-bordered"> <!-- Added bordered -->
                            <thead> <tr> <th>Store ID</th> <th>Name</th> <th>Actions</th> </tr> </thead>
                            <tbody id="stores-table-body"> <!-- Populated by JS --> </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Store Add/Edit Form Panel -->
        <div id="store-form-panel" class="content-panel">
             <div class="card section-card form-panel shadow-sm">
                <div class="card-header" id="store-form-header">Add New Store</div>
                <div class="card-body">
                     <form id="store-form" novalidate> <!-- Added novalidate -->
                        <input type="hidden" id="store-edit-id">
                        <input type="hidden" id="store-action-mode"> <!-- 'add' or 'edit' -->

                        <div class="mb-3">
                            <label for="store-name" class="form-label">Store Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="store-name" required>
                            <div class="invalid-feedback">Store name is required.</div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary cancel-btn" data-target="stores-list-panel">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Store</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Food List Panel -->
        <div id="food-list-panel" class="content-panel">
             <div class="card section-card shadow-sm">
                 <div class="card-header">
                     <span><i class="fas fa-utensils"></i> Manage Food Items</span>
                     <button class="btn btn-primary btn-sm add-btn" data-form-target="food-form-panel" data-list-target="food-list-panel">
                         <i class="fas fa-plus"></i> Add New Food
                     </button>
                 </div>
                 <div class="card-body">
                     <div class="table-responsive">
                        <table class="table table-striped table-hover table-bordered">
                             <thead><tr><th>Store Name</th><th>Food Name</th><th>Price</th><th>Actions</th></tr></thead>
                             <tbody id="food-table-body"> <!-- Populated by JS --> </tbody>
                         </table>
                    </div>
                 </div>
             </div>
        </div>

         <!-- Food Add/Edit Form Panel -->
        <div id="food-form-panel" class="content-panel">
            <div class="card section-card form-panel shadow-sm">
                <div class="card-header" id="food-form-header">Add New Food Item</div>
                <div class="card-body">
                    <form id="food-form" novalidate>
                        <input type="hidden" id="food-edit-id">
                        <input type="hidden" id="food-action-mode"> <!-- 'add' or 'edit' -->

                        <div class="mb-3">
                             <label for="food-store-id" class="form-label">Associated Store <span class="text-danger">*</span></label>
                             <select class="form-select" id="food-store-id" required>
                                 <option value="">Loading stores...</option>
                             </select>
                             <div class="invalid-feedback">Please select a store.</div>
                         </div>
                         <div class="mb-3">
                            <label for="food-name" class="form-label">Food Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="food-name" required>
                            <div class="invalid-feedback">Food name is required.</div>
                        </div>
                         <div class="mb-3">
                            <label for="food-price" class="form-label">Price (â‚±) <span class="text-danger">*</span></label>
                            <input type="number" step="0.01" min="0" class="form-control" id="food-price" required placeholder="e.g., 120.50">
                            <div class="invalid-feedback">Please enter a valid non-negative price.</div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary cancel-btn" data-target="food-list-panel">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Food Item</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Orders List Panel -->
         <div id="orders-list-panel" class="content-panel">
            <div class="card section-card shadow-sm">
                 <div class="card-header">
                     <span><i class="fas fa-receipt"></i> Manage Orders</span>
                     <!-- Add Order button could lead to a more complex form panel -->
                 </div>
                 <div class="card-body">
                     <div class="table-responsive">
                         <table class="table table-striped table-hover table-bordered">
                             <thead><tr><th>Order ID</th><th>Customer</th><th>Total</th><th>Status</th><th>Actions</th></tr></thead>
                             <tbody id="orders-table-body"></tbody>
                         </table>
                     </div>
                 </div>
             </div>
        </div>

        <!-- Users List Panel -->
        <div id="users-list-panel" class="content-panel">
            <div class="card section-card shadow-sm">
                 <div class="card-header">
                     <span><i class="fas fa-users"></i> Manage Users</span>
                     <button class="btn btn-primary btn-sm add-btn" data-form-target="user-form-panel" data-list-target="users-list-panel">
                         <i class="fas fa-plus"></i> Add New User
                     </button>
                 </div>
                 <div class="card-body">
                     <div class="table-responsive">
                         <table class="table table-striped table-hover table-bordered">
                             <thead><tr><th>User ID</th><th>Name</th><th>Email</th><th>Actions</th></tr></thead>
                             <tbody id="users-table-body"></tbody>
                         </table>
                     </div>
                 </div>
             </div>
        </div>

         <!-- User Add/Edit Form Panel -->
        <div id="user-form-panel" class="content-panel">
             <div class="card section-card form-panel shadow-sm">
                <div class="card-header" id="user-form-header">Add New User</div>
                <div class="card-body">
                     <form id="user-form" novalidate>
                        <input type="hidden" id="user-edit-id">
                        <input type="hidden" id="user-action-mode"> <!-- 'add' or 'edit' -->

                         <div class="mb-3">
                            <label for="user-name" class="form-label">User Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="user-name" required>
                             <div class="invalid-feedback">User name is required.</div>
                        </div>
                         <div class="mb-3">
                            <label for="user-email" class="form-label">User Email <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="user-email" required placeholder="name@example.com">
                            <div class="invalid-feedback">A valid email is required.</div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary cancel-btn" data-target="users-list-panel">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save User</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- == PANELS END == -->

    </main> <!-- End Main Content -->

    <!-- === Confirmation Modal (for Deletes etc.) === -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered"> <!-- Centered modal -->
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark"> <!-- Warning header -->
                    <h1 class="modal-title fs-5" id="confirmModalLabel"><i class="fas fa-exclamation-triangle"></i> Confirm Deletion</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="confirmModalMessage">Are you sure you want to perform this action?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmModalButton">Yes, Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!-- === End Confirmation Modal === -->

    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <!-- === Custom JavaScript === -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {

        // --- Data Store (Client-Side Example) ---
        let stores = [ { id: '123456123', name: "Ron's Turon" }, { id: '123456124', name: "Adobo House" }, { id: '123456125', name: "Carmela's Cakes" }, { id: '123456126', name: "The Poor Traveller Eatery" } ];
        let users = [ { id: '10001', name: "Adi Riv", email: "AdiRiv@gmail.com" }, { id: '10002', name: "Adrian Benedict", email: "adiibenn@gmail.com" } ];
        let foodItems = [ { id: 'f001', storeId: '123456123', name: "Turon Classic", price: 15.00 }, { id: 'f002', storeId: '123456124', name: "Pork Adobo", price: 120.00 }, { id: 'f003', storeId: '123456124', name: "Chicken Adobo", price: 110.00 }, { id: 'f004', storeId: '123456125', name: "Chocolate Cake Slice", price: 90.00 }, { id: 'f005', storeId: '123456126', name: "Pancit Canton", price: 85.00 } ];
        let orders = [ { id: 'ord101', customerId: '10001', total: 50.00, status: 'Pending' }, { id: 'ord102', customerId: '10002', total: 230.00, status: 'Delivered' }, { id: 'ord103', customerId: '10001', total: 110.00, status: 'Preparing' } ];

        // --- ID Counters ---
        let nextStoreId = 123456127; // Default starting point for stores
        let nextUserId = 10003;      // Default starting point for users

        // --- DOM Elements ---
        const mainContent = document.querySelector('main');
        const mainHeading = document.getElementById('main-heading');
        const sidebarLinks = document.querySelectorAll('aside .nav-link');
        const contentPanels = document.querySelectorAll('.content-panel');

        // Table Bodies
        const storeTableBody = document.getElementById('stores-table-body');
        const userTableBody = document.getElementById('users-table-body');
        const foodTableBody = document.getElementById('food-table-body');
        const ordersTableBody = document.getElementById('orders-table-body');

        // Forms & Fields
        const storeForm = document.getElementById('store-form');
        const storeFormHeader = document.getElementById('store-form-header');
        const storeEditIdInput = document.getElementById('store-edit-id');
        const storeActionModeInput = document.getElementById('store-action-mode');
        const storeNameInput = document.getElementById('store-name');

        const userForm = document.getElementById('user-form');
        const userFormHeader = document.getElementById('user-form-header');
        const userEditIdInput = document.getElementById('user-edit-id');
        const userActionModeInput = document.getElementById('user-action-mode');
        const userNameInput = document.getElementById('user-name');
        const userEmailInput = document.getElementById('user-email');

        const foodForm = document.getElementById('food-form');
        const foodFormHeader = document.getElementById('food-form-header');
        const foodEditIdInput = document.getElementById('food-edit-id');
        const foodActionModeInput = document.getElementById('food-action-mode');
        const foodStoreIdSelect = document.getElementById('food-store-id');
        const foodNameInput = document.getElementById('food-name');
        const foodPriceInput = document.getElementById('food-price');

        // Confirmation Modal Elements
        const confirmModalElement = document.getElementById('confirmModal');
        const confirmModal = new bootstrap.Modal(confirmModalElement);
        const confirmModalMessage = document.getElementById('confirmModalMessage');
        const confirmModalButton = document.getElementById('confirmModalButton');

        // --- Panel Switching Logic ---
        function showPanel(panelId) {
             contentPanels.forEach(panel => panel.classList.remove('active'));
             const targetPanel = document.getElementById(panelId);
             if (targetPanel) {
                 targetPanel.classList.add('active');
                 const panelTitle = targetPanel.querySelector('h2, .card-header')?.textContent.trim();
                 const link = document.querySelector(`aside .nav-link[data-target="${panelId}"]`);
                 mainHeading.textContent = panelTitle || (link ? link.textContent.trim() : "Admin Dashboard");
             } else {
                 console.warn("Panel not found:", panelId);
                 const overviewPanel = document.getElementById('dashboard-overview-panel');
                 if(overviewPanel) overviewPanel.classList.add('active');
                 mainHeading.textContent = "Dashboard Overview";
             }
             sidebarLinks.forEach(link => {
                 link.classList.remove('active');
                 if (link.dataset.target === panelId) link.classList.add('active');
             });
             mainContent.scrollTop = 0;
        }

        // --- Render Functions ---
        function renderStoresTable() {
            storeTableBody.innerHTML = '';
            if (stores.length === 0) { storeTableBody.innerHTML = '<tr><td colspan="3" class="text-center text-muted py-3">No stores found.</td></tr>'; return; }
            stores.forEach(store => {
                const row = document.createElement('tr'); row.setAttribute('data-id', store.id);
                row.innerHTML = `
                    <td>${store.id}</td>
                    <td>${store.name}</td>
                    <td class="action-buttons">
                        <button class="btn btn-outline-warning btn-sm edit-btn" data-type="store" data-id="${store.id}" data-form-target="store-form-panel" title="Edit Store"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" data-type="store" data-id="${store.id}" title="Delete Store"><i class="fas fa-trash-alt"></i></button>
                    </td> `;
                storeTableBody.appendChild(row);
            });
        }
        function renderUsersTable() {
             userTableBody.innerHTML = '';
             if (users.length === 0) { userTableBody.innerHTML = '<tr><td colspan="4" class="text-center text-muted py-3">No users found.</td></tr>'; return; }
             users.forEach(user => {
                 const row = document.createElement('tr'); row.setAttribute('data-id', user.id);
                 row.innerHTML = `
                    <td>${user.id}</td><td>${user.name}</td><td>${user.email}</td>
                    <td class="action-buttons">
                        <button class="btn btn-outline-warning btn-sm edit-btn" data-type="user" data-id="${user.id}" data-form-target="user-form-panel" title="Edit User"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" data-type="user" data-id="${user.id}" title="Delete User"><i class="fas fa-trash-alt"></i></button>
                    </td> `;
                 userTableBody.appendChild(row);
             });
        }
        function renderFoodTable() {
             foodTableBody.innerHTML = '';
             if (foodItems.length === 0) { foodTableBody.innerHTML = '<tr><td colspan="4" class="text-center text-muted py-3">No food items found.</td></tr>'; return; }
             foodItems.forEach(item => {
                 const store = stores.find(s => s.id === item.storeId);
                 const storeName = store ? store.name : 'Unknown Store';
                 const row = document.createElement('tr'); row.setAttribute('data-id', item.id);
                 row.innerHTML = `
                    <td>${storeName}</td><td>${item.name}</td><td>â‚±${item.price.toFixed(2)}</td>
                     <td class="action-buttons">
                         <button class="btn btn-outline-warning btn-sm edit-btn" data-type="food" data-id="${item.id}" data-form-target="food-form-panel" title="Edit Food Item"><i class="fas fa-edit"></i></button>
                         <button class="btn btn-outline-danger btn-sm delete-btn" data-type="food" data-id="${item.id}" title="Delete Food Item"><i class="fas fa-trash-alt"></i></button>
                     </td>`;
                 foodTableBody.appendChild(row);
             });
        }
        function renderOrdersTable() {
             ordersTableBody.innerHTML = '';
             if (orders.length === 0) { ordersTableBody.innerHTML = '<tr><td colspan="5" class="text-center text-muted py-3">No orders found.</td></tr>'; return; }
             orders.forEach(order => {
                 const user = users.find(u => u.id === order.customerId);
                 const customerName = user ? user.name : `User ID ${order.customerId || 'N/A'}`;
                 let statusBadgeClass = 'bg-secondary';
                 if (order.status === 'Pending') statusBadgeClass = 'bg-warning text-dark'; else if (order.status === 'Preparing') statusBadgeClass = 'bg-info text-dark'; else if (order.status === 'Out for Delivery') statusBadgeClass = 'bg-primary'; else if (order.status === 'Delivered') statusBadgeClass = 'bg-success'; else if (order.status === 'Cancelled') statusBadgeClass = 'bg-danger';
                 const row = document.createElement('tr'); row.setAttribute('data-id', order.id);
                 row.innerHTML = `
                    <td>${order.id}</td><td>${customerName}</td><td>â‚±${order.total.toFixed(2)}</td><td><span class="badge ${statusBadgeClass} px-2 py-1">${order.status}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-outline-info btn-sm status-btn" data-type="order" data-id="${order.id}" title="Update Status"><i class="fas fa-sync-alt"></i></button>
                        <button class="btn btn-outline-danger btn-sm delete-btn" data-type="order" data-id="${order.id}" title="Delete Order"><i class="fas fa-trash-alt"></i></button>
                    </td>`;
                 ordersTableBody.appendChild(row);
             });
        }

        // --- Update Stats ---
        function updateStats() {
            document.getElementById('total-stores').textContent = stores.length;
            document.getElementById('total-users').textContent = users.length;
            document.getElementById('total-deliveries').textContent = orders.filter(o => o.status === 'Delivered').length;
            const totalRevenue = orders.filter(o => o.status === 'Delivered').reduce((sum, order) => sum + order.total, 0);
            document.getElementById('total-revenue').textContent = `â‚±${totalRevenue.toFixed(2)}`;
        }

        // --- Form Handling ---
        function clearFormValidation(formElement) {
            formElement.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
            formElement.reset();
        }
        function setupFormPanel(type, mode = 'add', id = null) {
             let formElement, headerElement, idInput, modeInput, targetPanelId;
             switch (type) { /* ... unchanged ... */
                case 'store': formElement = storeForm; headerElement = storeFormHeader; idInput = storeEditIdInput; modeInput = storeActionModeInput; targetPanelId = 'store-form-panel'; break;
                case 'user': formElement = userForm; headerElement = userFormHeader; idInput = userEditIdInput; modeInput = userActionModeInput; targetPanelId = 'user-form-panel'; break;
                case 'food':
                    formElement = foodForm; headerElement = foodFormHeader; idInput = foodEditIdInput; modeInput = foodActionModeInput; targetPanelId = 'food-form-panel';
                     foodStoreIdSelect.innerHTML = '<option value="">Select a store...</option>';
                     stores.forEach(store => { const option = document.createElement('option'); option.value = store.id; option.textContent = `${store.name} (${store.id})`; foodStoreIdSelect.appendChild(option); });
                     break;
                default: console.error("Unknown type for form panel setup:", type); return;
            }
            clearFormValidation(formElement);
            modeInput.value = mode; idInput.value = id || '';
            if (mode === 'edit' && id) { /* ... unchanged ... */
                headerElement.textContent = `Edit ${type.charAt(0).toUpperCase() + type.slice(1)}`;
                let item;
                 switch (type) {
                    case 'store': item = stores.find(s => s.id === id); if(item) storeNameInput.value = item.name; break;
                    case 'user': item = users.find(u => u.id === id); if(item) { userNameInput.value = item.name; userEmailInput.value = item.email; } break;
                    case 'food': item = foodItems.find(f => f.id === id); if(item) { foodStoreIdSelect.value = item.storeId; foodNameInput.value = item.name; foodPriceInput.value = item.price; } break;
                }
                 if (!item) {
                    console.error(`Item not found for edit: type=${type}, id=${id}`);
                    alert("Error: Could not find the item to edit.");
                    showPanel(`${type}s-list-panel`); return;
                 }
            } else { headerElement.textContent = `Add New ${type.charAt(0).toUpperCase() + type.slice(1)}`; }
            showPanel(targetPanelId);
        }
        function validateForm(formElement) { /* ... unchanged ... */
             let isValid = true;
             formElement.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
             const inputs = formElement.querySelectorAll('input[required], select[required], textarea[required]');
             inputs.forEach(input => {
                 let inputValid = true; const value = input.value.trim();
                 if (input.required && !value) { inputValid = false; }
                 if (input.type === 'email' && value && !/^\S+@\S+\.\S+$/.test(value)) { inputValid = false; }
                 if (input.type === 'number' && input.value !== '' && (isNaN(parseFloat(input.value)) || parseFloat(input.value) < 0)) { inputValid = false; }
                 if (!inputValid) { isValid = false; input.classList.add('is-invalid'); }
             });
             return isValid;
        }

        // --- Event Listeners ---
        sidebarLinks.forEach(link => { /* ... unchanged ... */
             link.addEventListener('click', (e) => { e.preventDefault(); const targetPanelId = link.dataset.target; if (targetPanelId) showPanel(targetPanelId); });
        });

        mainContent.addEventListener('click', (e) => { /* ... unchanged ... */
             const button = e.target.closest('button');
            if (!button) return;

            if (button.classList.contains('add-btn')) { const formTarget = button.dataset.formTarget; const type = formTarget.split('-')[0]; setupFormPanel(type, 'add'); }
            else if (button.classList.contains('edit-btn')) { const type = button.dataset.type; const id = button.dataset.id; setupFormPanel(type, 'edit', id); }
            else if (button.classList.contains('delete-btn')) {
                 const type = button.dataset.type; const id = button.dataset.id; let itemName = ''; let itemArray;
                 switch (type) {
                     case 'store': itemArray = stores; itemName = itemArray.find(i => i.id === id)?.name; break;
                     case 'user': itemArray = users; itemName = itemArray.find(i => i.id === id)?.name; break;
                     case 'food': itemArray = foodItems; itemName = itemArray.find(i => i.id === id)?.name; break;
                     case 'order': itemArray = orders; itemName = `Order #${id}`; break;
                     default: return;
                 }
                 if (!itemName) itemName = `Item ID ${id}`;
                 confirmModalMessage.textContent = `Are you sure you want to delete ${type} "${itemName}" (ID: ${id})? This action cannot be undone.`;
                 confirmModalButton.dataset.deleteType = type;
                 confirmModalButton.dataset.deleteId = id;
                 confirmModal.show();
            }
            else if (button.classList.contains('cancel-btn')) { const targetListPanel = button.dataset.target; if (targetListPanel) showPanel(targetListPanel); }
            else if (button.classList.contains('status-btn')) {
                 const orderId = button.dataset.id; const order = orders.find(o => o.id === orderId);
                 if(order) {
                    const statuses = ['Pending', 'Preparing', 'Out for Delivery', 'Delivered', 'Cancelled'];
                     const currentIndex = statuses.indexOf(order.status);
                     const nextIndex = (currentIndex + 1) % statuses.length;
                     order.status = statuses[nextIndex];
                     renderOrdersTable(); updateStats(); console.log(`Order ${orderId} status updated to ${order.status}`);
                 }
            }
        });

        confirmModalButton.addEventListener('click', () => { /* ... unchanged ... */
            const type = confirmModalButton.dataset.deleteType; const id = confirmModalButton.dataset.deleteId;
            if (!type || !id) { console.error("Missing type/id for delete."); confirmModal.hide(); return; }
            let itemArray, renderFunc;
            switch (type) { /* ... unchanged case logic ... */
                 case 'store': itemArray = stores; renderFunc = renderStoresTable; break;
                 case 'user': itemArray = users; renderFunc = renderUsersTable; break;
                 case 'food': itemArray = foodItems; renderFunc = renderFoodTable; break;
                 case 'order': itemArray = orders; renderFunc = renderOrdersTable; break;
                 default: console.error("Unknown type for delete:", type); confirmModal.hide(); return;
             }
            const index = itemArray.findIndex(item => item.id === id);
            if (index > -1) { itemArray.splice(index, 1); renderFunc(); updateStats(); console.log(`${type} with ID ${id} deleted.`); }
            else { console.error(`Item not found for delete: type=${type}, id=${id}`); }
            delete confirmModalButton.dataset.deleteType; delete confirmModalButton.dataset.deleteId;
            confirmModal.hide();
        });

        // --- Form Submit Handler (MODIFIED for User ID) ---
        function handleFormSubmit(e, formType) {
             e.preventDefault();
             let formElement, idInput, modeInput, dataArray, renderFunc, listPanelId, itemData;
             switch (formType) {
                case 'store': formElement = storeForm; idInput = storeEditIdInput; modeInput = storeActionModeInput; dataArray = stores; renderFunc = renderStoresTable; listPanelId = 'stores-list-panel'; itemData = { name: storeNameInput.value.trim() }; break;
                case 'user': formElement = userForm; idInput = userEditIdInput; modeInput = userActionModeInput; dataArray = users; renderFunc = renderUsersTable; listPanelId = 'users-list-panel'; itemData = { name: userNameInput.value.trim(), email: userEmailInput.value.trim() }; break;
                case 'food': formElement = foodForm; idInput = foodEditIdInput; modeInput = foodActionModeInput; dataArray = foodItems; renderFunc = renderFoodTable; listPanelId = 'food-list-panel'; itemData = { storeId: foodStoreIdSelect.value, name: foodNameInput.value.trim(), price: parseFloat(foodPriceInput.value) }; break;
                default: console.error("Unknown form type:", formType); return;
             }
             if (!validateForm(formElement)) { console.log("Validation failed for", formType); return; }
             const mode = modeInput.value; const id = idInput.value;

             if (mode === 'edit' && id) { /* Editing logic (unchanged) */
                 const index = dataArray.findIndex(item => item.id === id);
                 if (index > -1) { dataArray[index] = { ...dataArray[index], ...itemData }; console.log(`${formType} updated:`, dataArray[index]); }
                 else { console.error("Item not found for edit:", id); }
             } else { // Adding New Item
                 // ID Generation Logic
                 if (formType === 'store') {
                     itemData.id = nextStoreId.toString();
                     nextStoreId++;
                 } else if (formType === 'user') { // *** NEW User ID Logic ***
                     itemData.id = nextUserId.toString();
                     nextUserId++;
                 } else { // Fallback for other types
                     itemData.id = formType + '-' + Date.now();
                 }
                 // End ID Generation
                 dataArray.push(itemData);
                 console.log(`${formType} added:`, itemData);
             }
             renderFunc(); updateStats(); showPanel(listPanelId);
        }

        storeForm.addEventListener('submit', (e) => handleFormSubmit(e, 'store'));
        userForm.addEventListener('submit', (e) => handleFormSubmit(e, 'user'));
        foodForm.addEventListener('submit', (e) => handleFormSubmit(e, 'food'));

        // --- Initial Load (MODIFIED for User ID) ---
        function initializeDashboard() {
            // Calculate initial nextStoreId
            const currentStoreIds = stores.map(store => parseInt(store.id, 10)).filter(id => !isNaN(id) && id >= 123456123);
            if (currentStoreIds.length > 0) { nextStoreId = Math.max(...currentStoreIds) + 1; }

            // *** NEW: Calculate initial nextUserId ***
            const currentUserIds = users.map(user => parseInt(user.id, 10)).filter(id => !isNaN(id) && id >= 10001);
            if (currentUserIds.length > 0) {
                nextUserId = Math.max(...currentUserIds) + 1;
            }
            // Ensure nextUserId is at least the minimum starting value
            nextUserId = Math.max(nextUserId, 10003);
            // *** END NEW ***

            // Render tables and stats
            renderStoresTable(); renderUsersTable(); renderFoodTable(); renderOrdersTable(); updateStats();
            showPanel('dashboard-overview-panel'); // Start on overview
            console.log(`Admin Dashboard Initialized. Next Store ID: ${nextStoreId}, Next User ID: ${nextUserId}`);
        }
        initializeDashboard();

      }); // End DOMContentLoaded
    </script>
    <!-- ========================= -->

</body>
</html>